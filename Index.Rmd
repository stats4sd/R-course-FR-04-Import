---
title: "Importation de données"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
runtime: shiny_prerendered
description: >
  Apprenez à importer des données à partir de RStudio.
---


```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(knitr)
tutorial_options(exercise.timelimit = 10)
```


##  Overview

Dans cette partie du tutoriel, nous allons discuter du processus d'importation de données dans R, qui consiste à

- s'assurer que la mise en forme des données est bonne 
- enregistrer les données dans un format adapté à R
- importer les données depuis RStudio


Voici une vidéo où ces étapes sont brièvement expliquées:

![](https://youtu.be/truh-B_S-v4)



##  Mise en forme des données

Parlons d'abord de la mise en forme des données. Si vous voulez importer des données dans R - ou dans n'importe quel logiciel statistique en fait - il faut que vos données aient la bonne mise en forme. Elles doivent former un seul "rectangle" de données, composé de colonnes et de lignes dont la taille ne varie pas, et où

- chaque ligne représente une observation.
- chaque colonne représente une variable.

La communauté R appelle cela des *tidy data* (données bien rangées). Voici une  présentation illustrant ce concept de *tidy data* :<a href="https://docs.google.com/presentation/d/1N7hKepabvl9OrHjvGJWPjUsfzVdB5xzV5AsFndgSwms/edit?usp=sharing" target="_blank">Make friends with tidy data </a> 

Il faut aussi que les noms de vos colonnes soient tout en haut, sur une **seule** ligne, et que le reste de vos données commence juste en dessous de cette première ligne, comme dans cette capture d'écran.

```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/well_formattedbis.PNG")
```

Tout ce qui se trouve dans votre rectangle de données doit faire partie de vos données. Il n'y a aucun problème à avoir des colones  vides, mais celles-ci doivent être vides parce que les valeurs correspondantes sont manquantes. 




### Evitez de fusionner les cellules
Dans les tableurs tels que Excel, il est souvent tentant de fusionner des cellules afin de rendre les choses plus "jolies" ou claires. Le problème est que les cellules fusionnées ne se transfèrent pas bien dans d'autres logiciels. Ainsi, si vous souhaitez examiner vos données à partir de R ou de tout autre logiciel statistique, ne fusionnez pas vos cellules! Au lieu de cela, copiez la valeur correspondante dans toutes les colonnes correspondantes:
```{r echo=FALSE, out.width="80%", fig.align='left'}
knitr::include_graphics("./images/merge2bis.PNG")
```

###  Bonnes practiques concernant les noms de colonnes
Il est préférable que les noms de vos colonnes aient un sens, mais qu'ils soient aussi courts, et qu'ils n'incluent pas d'espaces, d'accents ou autres caractères spéciaux, à l'exception des symboles point et tiret bas (tiret de huit). Ces regles vous semblent peu-etre familieres. C'est normal, car les règles de dénomination des colonnes sont a peu pres les mêmes que celles qui régissent la dénomination des objets (voir le tutoriel du module Introduction). Et ce n'est pas surprenant, car les colonnes sont essentiellement des objets qui se trouvent dans des tableaux de données.

Par exemple, une colonne appelée "Température Minimale", pourrait être abrégée en "temp.min". Ce nom est clair, concis et ne contient pas de caracteres speciaux autre qu'un point. 


###  Données manquantes

Comme nous l'avons dit plus haut, les données manquantes ne posent aucun problème. Enfin elles peuvent être un problème pour votre analyse, mais ce n'est pas un problème pour l'importation de données. Il est courant que les gens aient un code spécifique pour représenter les valeurs manquantes, comme -1, 99 ou NA. Ces codes sont tous acceptables. L'important est de choisir un code qui ne peut pas être une valeur prise par vos données non manquantes, et que l'ensemble soit cohérent. Si vous codez les valeurs manquantes différemment pour chacune de vos colonnes, vous vous exposez à des problèmes. Ma préférence personnelle est de laisser simplement le champ vide. Un champ vide est facile à repérer et R la reconnaîtra automatiquement comme une valeur manquante.


### Comment mettre en forme des données ?

Idéalement, la mise en forme de vos données doit être réfléchie dès le début, au stade de la conception de votre étude, de sorte que lors de la collecte de données, vos données aient déjà la bonne forme. Malheureusement, les choses ne se passent pas toujours comme prévu et vous n'avez pas toujours le contrôle sur la manière dont les données sont collectées. Dans ce cas, vous pourriez vous retrouver avec des données qui ne sont pas dans la forme "tidy data" décrite avant.

Il y a deux façons de gérer cela. Soit rearranger les données dans un logiciel comme Excel, soit le faire directement dans R. La premiere solution est probablement plus simple au début, mais à un moment donné, lorsque vous aurez plus d'expérience avec R, vous devriez envisager de faire la plupart du travail dans R, de sorte que vous ayez un script documentant clairement ce que vous faites et permettant que tout ce que vous faites sur les données soit reproductible.

Dans les deux cas, assurez-vous de conserver une copie de vos données modifiees et une copie de vos données d'origine, au cas où il y aurait un problème.


## Format de votre fichier de donnees

Si vos données se trouvent dans une feuille de calcul de type Excel, Google Sheets ou LibreOffice Calc, nous vous recommandons d'enregistrer vos données au format `csv`. Il existe des packages externes qui peuvent vous aider à importer des données directement depuis Excel, mais d'après notre expérience, les choses ont de grandes chances de se dérouler correctement si vous importez vos données depuis un fichier `csv`. Un fichier `csv` est un simple fichier texte dans lequel vos valeurs sont séparées par un caractère spécifique. Comme "csv" signifie "comma separated value", vous pouvez deviner qu'en général, ce caractère spécifique est la virgule (comma signifie virgule en anglais).


Téléchargez ce fichier Excel et suivez les étapes decrites ci-dessous, en utilisant l'onglet appelé "Exple1 - good" comme la feuille de données que nous voulons sauvegarder : [BasicExample.xlsx](https://github.com/stats4sd/R-course-FR-04-Import/raw/main/BasicExample.xlsx)
Notez que si vous n'avez pas Excel sur votre ordinateur, utilisez n'importe quel logiciel de tableur que vous aimez. Les étapes devraient être très similaires.


Tout d'abord, cliquez sur l'onglet des données que vous voulez sauvegarder. Vérifiez que la mise en forme des données est bonne, puis cliquez sur `File -> Save As` (ou Fichier -> Sauvegarder Sous)

```{r echo=FALSE, out.width="80%", fig.align='left'}
knitr::include_graphics("./images/save0bis.PNG")
```

Choisissez l'endroit où vous voulez sauvegarder votre fichier, donnez-lui un nom pertinent, et dans `Save as types`, choisissez `CSV (comma delimited)` (ou similaire). Il est recommandé de le sauvegarder dans le même dossier que votre projet RStudio.

```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/save3.PNG")
```

Enfin, cliquez sur `Save` (Sauvegarder). Il se peut que vous receviez un avertissement vous indiquant que vous n'enregistrez qu'une seule de vos feuilles, ce qui est normal. Vous voulez simplement sauvegarder les données de l'onglet actif.


Si vos données proviennent d'un autre logiciel statistique comme SAS, SPSS, STATA, ou d'une base de données SQL, alors, vos données sont déjà dans un format qui est pret pour l'importation.


*Question : téléchargez le fichier Excel suivant contenant les données d'une expérience en station et essayez de l'enregistrer sous forme de fichier csv, en suivant les étapes decrite au dessus. Appelez ce fichier Fallow.csv*.
[Fallow.xlsx](https://github.com/stats4sd/R-course-FR-04-Import/raw/main/Fallow.xlsx)





## Importation des données


### Assurez-vous d'avoir un fichier de script R Markdown

Pour commencer, vous devez vous trouver dans votre dossier de projet et avoir un nouveau fichier R Markdown vide ouvert. Pour créer un nouveau fichier R Markdown, faites `File -> New file -> R Markdown...` 

```{r echo=FALSE, out.width="80%", fig.align='left'}
knitr::include_graphics("./images/rmarkdown.PNG")
```

Pour qu'il soit vide, cliquez simplement sur `Create Empty Document` en bas à gauche de la fenêtre suivante.

```{r echo=FALSE, out.width="60%", fig.align='left'}
knitr::include_graphics("./images/rmarkdown2.PNG")
```



### Importation du fichier

R peut importer des données à partir de nombreux formats différents et nous ne les couvrirons pas tous ici. En particulier, nous ne verrons pas comment récupérer des données d'une base de données SQL, car cela est légèrement plus avancé que le champ d'application de ce cours. La documentation suivante <a href="https://db.rstudio.com" target="_blank">here </a> devrait cependant constituer un bon point de départ. Si vous avez des questions à ce sujet, n'hésitez pas à les poster dans le forum "Questions pas directement liées au cours". 

Pour les données provenant de SAS, SPSS ou STATA, vous devrez utiliser un package externe pour importer votre fichier dans R. Il existe de nombreuses options, mais nous vous recommandons d'utiliser le package `haven`, qui est un autre package inclus dans `tidyverse`. Ce qui est bien avec ce package est qu'il est intégré dans le menu d'importation de RStudio, et donc la méthode pour importer des données fonctionne de la même manière qu'avec un fichier csv. C'est à dire :


Depuis Rstudio, cliquez sur le menu `import dataset`. Il est situé en haut à droite de votre écran si vous n'avez pas modifié l'organisation par défaut des fenêtres de Rstudio.
```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/import1.PNG")
```

Vous pouvez voir que vous avez plusieurs options à choisir. Si vous importez des données depuis SAS, SPSS ou STATA, vous utiliserez l'option correspondante en bas du menu. Cela nécessite l'installation du package "haven", mais comme nous l'avons déjà dit, il fait partie de tidyverse, donc si tidyverse est installé, cela devrait bien fonctionner. Vous pouvez également voir l'option "From Excel...". L'importation de données directement depuis Excel est donc également possible via le menu. Mais comme nous l'avons dit précédemment, il est possible d'avoir des problèmes inattendus lors de l'importation de données directement depuis Excel (en particulier par ce menu), nous vous recommandons donc de vous en tenir à une importation via un fichier csv. Et si vos données sont sauvegardées dans un fichier csv, vous devez simplement cliquer sur la première option. `From Text (base)`
```{r echo=FALSE, out.width="70%", fig.align='left'}
knitr::include_graphics("./images/import2.PNG")
```


Localisez votre fichier csv
```{r echo=FALSE, out.width="70%", fig.align='left'}
knitr::include_graphics("./images/import3.PNG")
```
Vérifiez dans la fenêtre d'aperçu que l'importation semble bien fonctionner. Si vous constatez des problèmes tels que des noms de colonne bizarres, des lignes ou des colonnes bizarres, jouez avec les paramètres à gauche pour résoudre ces problèmes. Cliquez sur `Import`
```{r echo=FALSE, out.width="80%", fig.align='left'}
knitr::include_graphics("./images/import4.PNG")
```


Vérifiez dans votre fenêtre d'environnement le nombre de lignes et de colonnes de votre nouvel objet.
```{r echo=FALSE, out.width="60%", fig.align='left'}
knitr::include_graphics("./images/import5.PNG")
```

Cliquez sur le triangle à côté du nom de votre objet pour avoir un aperçu des types de colonnes. Vérifiez que les colonnes qui devraient être numériques ne sont pas listées comme des variables de type caractère (chr). Si vous trouvez un tel problème, cela signifie probablement qu'il y a un ou plusieurs caractère(s) non numériques quelque part dans vos données d'origine qui ont empêché R de considérer la colonne comme numérique.
```{r echo=FALSE, out.width="60%", fig.align='left'}
knitr::include_graphics("./images/import6bis.PNG")
```

Copiez la commande que R vient d'écrire dans le fenetre de console (seulement la commande `read.csv()`. La commande `View()` est une commande interactive qui ne doit pas figurer dans vos scripts).
```{r echo=FALSE, out.width="80%", fig.align='left'}
knitr::include_graphics("./images/import7.PNG")
```

Insérez un premier bloc de code R en haut de votre fichier R Markdown.
```{r echo=FALSE, out.width="50%", fig.align='left'}
knitr::include_graphics("./images/import8.PNG")
```


Ensuite, collez la commande d'importation à l'intérieur de ce bloc de code R 
```{r echo=FALSE, out.width="70%", fig.align='left'}
knitr::include_graphics("./images/import9.PNG")
```

Nous avons terminé l'étape d'importation. Nous pouvons maintenant commencer à travailler sur les données. N'oubliez pas de charger les packages dont vous aurez besoin et d'écrire du texte à l'extérieur des bloc de code R pour documenter ce que vous faites.
```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/import10.PNG")
```


Il est important d'avoir la commande d'importation dans votre fichier script R Markdown, de sorte que la prochaine fois que vous ouvrez RStudio, vous n'ayez pas a repasser par le processus d'importation. Vous pourrez alors simplement exécuter le bloc de cose R correspondant et vos données seront importées !

Remarque : vous pouvez voir que la commande d'importation contient un chemin d'accès à votre fichier de données. Ainsi, si vous déplacez vos données, par exemple pour les placer dans un dossier de données spécifique de votre projet, vous devrez modifier le chemin.


*Question : Suivez les étapes decrites au dessus pour importer le fichier Fallow.csv que vous avez enregistré dans la section précédente. Consultez l'annexe si vous souhaitez en savoir plus sur ce jeu de données*.



## Quiz

*Question 1*

```{r Q1, echo=FALSE}
question("Laquelle de ces affirmations est vraie ?",
  answer("RStudio est inutile sans R",correct=TRUE),
  answer("R est un puissant environnement de développement interactif", message="Non, RStudio est l'IDE"),
  answer("Sans RStudio, vous ne pouvez pas utiliser R", message="R peut très bien fonctionner sans RStudio. C'est juste qu'il n'est pas si facile à utiliser"),
  answer("Vous devez d'abord installer RStudio, puis vous pouvez installer R", message="Non, vous devez commencer par installer R"), allow_retry = TRUE,random_answer_order = TRUE
)
```




```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/packageQuestion.JPG")
```


*Question 2*

```{r Q2, echo=FALSE}
question("Pourquoi R donne-t-il une erreur dans la capture d'écran ci-dessus ?",
  answer("La commande pour lire les données est manquante",message="Non, il est présent en haut du fichier: BeanSurvey <- read.csv('bean_survey.csv')"),
  answer("La commande library(ggplot2) est manquante", message="Il manque, mais nous n'en avons pas besoin, puisque nous ne traçons rien."),
  answer("Nous n'avons pas donné de nom a notre resume statistique dans la fonction summarise()", message="Il est bon de nommer nos calculs, mais l'omission du nom n'est pas une 'erreur'"),
  answer("Les noms des colonnes sont incorrects", message="Non, les noms des colonnes sont corrects"),
  answer("Les pipes ne fonctionnent pas dans les bloc de code R", message="les pipes fonctionnent très bien dans les chunks R"),
  answer("Le fichier de projet RStudio n'a pas été créé", message="Nous ne pouvons pas dire à partir de cette capture d'écran si un fichier de projet a été créé ou non. Cependant, nous pouvons dire qu'il ne peut pas être responsable de l'erreur."),
  answer("La commande library(dplyr) est manquante", correct=TRUE),
  answer("Le symbole utilisé pour l'opérateur pipe est erroné", message="%>% est le bon symbole pour l'opérateur pipe"),
  answer("Nous utilisons des *pipe*, mais l'argument de données de chaque fonction est manquant", message="La commande pipe est correcte. Avec les pipes, nous omettons le premier argument *data* des fonctions"), allow_retry = TRUE,random_answer_order = TRUE
)
```




```{r echo=FALSE, out.width="100%", fig.align='left'}
knitr::include_graphics("./images/Quiz1.PNG")
```


*Question 3*

```{r Q3, echo=FALSE}
question("Le fichier R Markdown ci-dessus fonctionne bien, mais l'utilite de R Markdown n'est pas vraiment exploite. Pourquoi?",
  answer("Les commentaires devraient faire partie du texte en dehors des blocs de code R. De cette façon, un document R Markdown peut devenir un véritable rapport.",correct=TRUE),
  answer("Avec R Markdown, tous les packages sont déjà préchargées, il n'est donc pas nécessaire d'avoir des commandes *library()* qui chargent les packages !", message="Non, vous devez toujours charger les packages dans un fichier R Markdown."),
  answer("R Markdown est fait pour écrire du code R. Idéalement, nous ne devrions pas avoir de texte ou de commentaire dans un tel document, afin qu'il soit reproductible.", message="Non, l'avantage de R Markdown est qu'il est idéal pour rédiger des rapports reproductibles. Il doit donc contenir du texte"),
  answer("Les commandes doivent toutes être incluses dans le même bloc de code R, afin qu'elles puissent être exécutées ensemble. C'est ca l'idee derriere R Markdown !", message="Non, avoir toutes les commandes à l'intérieur d'un seul et unique bloc de code R n'exploite pas non plus l'interet de R Markdown."), allow_retry = TRUE,random_answer_order = TRUE
)
```


*Question 4*

```{r Q4, echo=FALSE}
question("Qu'est-ce qui est important pour vos données si vous voulez les importer dans R ? (sélectionnez toutes les réponses correctes)",
  answer("Elles doivent être constitué d'un seul rectangle de données.",correct=TRUE),
  answer("Les noms des colonnes ne doivent figurer que sur une seule ligne", correct=TRUE),
  answer("Il ne doit pas y avoir d'espace vide entre les lignes ou les colonnes.", correct=TRUE),
  answer("Toutes les colonnes doivent avoir la même longueur, et il en va de même pour les lignes", correct=TRUE),
  answer("Elles ne doivent pas contenir de cellules fusionnées", correct=TRUE), allow_retry = TRUE,random_answer_order = TRUE
)
```




## Exercises


**Exercice 1 : Maintenant que vous avez importé le jeu de données Fallow dans R, faisons un exercice rapide pour récapituler ce que nous avons appris dans les modules 1 à 4, mais en écrivant le code entièrement dans RStudio au lieu de le faire en ligne**.



1.	Calculez le rendement moyen et le nombre de strigas pour chaque traitement.
2.	Créer un sous-ensemble du tableau de donnees entier, avec seulement les lignes où le nombre de strigas est supérieur à 0.
3.	Faites un graphique à partir du sous-ensemble que vous venez de créer (ou de l'ensemble des données si vous n'avez pas réussi à créer le sous-ensemble), montrant la relation entre le nombre de strigas et le rendement.
 

**Exercice 2 : Téléchargez les fichiers ci-dessous qui contiennent le jeu de données BeanSurvey et les solutions pour les exercices du module 3 et du module 4. Enregistrez-les dans votre dossier de projet. Importez les données en utilisant le menu RStudio et parcourez le fichier R Markdown pour reproduire les solutions dans votre propre machine**.

[ggplot-part2-solutions.zip](https://github.com/stats4sd/R-course-FR-04-Import/raw/main/module-ggplot2-partie2-solutions.zip)

[dplyr-solutions.zip](https://github.com/stats4sd/R-course-FR-04-Import/raw/main/module-dplyr-solutions.zip)





## Appendix: 'Fallow' dataset  

Le jeu de données 'Fallow' provient d'une expérience RCBD en station qui étudie l'effet des traitements de couverture des cultures sur les rendements de maïs et le nombre de strigas.

Un résumé des colonnes du jeu de données est présenté ci-dessous.

```{r, echo=FALSE,message=FALSE,warning=FALSE}

data.frame(Column=c("rep", "plot", "treat", "yield", "striga"),
           Description=c("repetition","plot","treatment","yield in tons per hectare","striga counts")) %>% knitr::kable()

```

## Appendix: 'BeanSurvey' dataset 

Les données que nous utilisons dans cette session sont un extrait d'une enquête menée en Ouganda auprès d'agriculteurs identifiés comme cultivant des haricots.

Le jeu de données contient un extrait de 50 réponses à 23 des questions de l'enquête, et a été importé dans R comme un cadre de données appelé `BeanSurvey`.

Un résumé des colonnes du jeu de données est présenté ci-dessous.

```{r, echo=FALSE,message=FALSE,warning=FALSE}

BeanSurvey <- read.csv("bean_survey.csv")
data.frame(Column=colnames(BeanSurvey),
           Description=c("Identifiant de l'agriculteur", "Nom du village", "Composition du ménage", "Sexe du chef de ménage", "Âge du chef de ménage",
                         "Occupation du chef de ménage", "Nombre d'adultes dans le ménage", "Nombre d'enfants (<18) au sein du ménage", "Cultivent-ils du matoke?",
                         "Cultivent-ils du maïs?", "Cultivent-ils des haricots?", "Cultivent-ils des bananes?", "Cultivent-ils du manioc?",
                         "Cultivent-ils du café?", "Superficie de la ferme (acres)", "Utilisation de la main-d'oeuvre", "Cultures intercalaires avec des haricots",
                         "Responsabilité de décision des ménages", "Cultivent-ils des haricots pour la vente?", "Quantité de haricots plantés pendant la longue saison des pluies",
                         "Quantité de haricots plantés pendant la courte saison des pluies", "Quantité de haricots récoltés pendant la longue saison des pluies"
                         , "Quantité de haricots récoltés pendant la courte saison des pluies")) %>% kable()

```


Passez un peu de temps à explorer l'ensemble des données ci-dessous, pour vous familiariser avec les colonnes et le type de données stockées dans chaque colonne. Vous aurez peut-être besoin de vous référer à ces données à certains moments au cours de ce tutoriel. N'oubliez pas que R est sensible à la casse, vous devrez donc toujours vous référer aux variables de cet jeu de données exactement comme elles sont écrites dans les données. Il y a une colonne dans ces données appelée "GENDERHH" mais il n'y a pas de colonne dans ces données appelée "GenderHH".

```{r,echo=FALSE}
DT::datatable(BeanSurvey)
```

(Vous pouvez utiliser les touches fléchées de votre clavier pour faire défiler vers la droite au cas où le tableau de données ne tiendrait pas entièrement sur votre écran)


## Appendix:  Useful reference links  


Présentation illustrée des "données ordonnées": <a href="https://docs.google.com/presentation/d/1N7hKepabvl9OrHjvGJWPjUsfzVdB5xzV5AsFndgSwms/edit?usp=sharing" target="_blank">Make friends with tidy data </a> 

Vidéo expliquant la commande d'importation de fichiers texte dans R - DataCamp:<a href="https://www.youtube.com/watch?v=Yy-ismDUkkQ" target="_blank">https://www.youtube.com/watch?v=Yy-ismDUkkQ   </a> 

Article sur le site de support de RStudio montrant comment importer des données à partir de différents fichiers via le menu d'importation de RStudio:<a href="https://support.rstudio.com/hc/en-us/articles/218611977-Importing-Data-with-RStudio" target="_blank">Importing Data with RStudio</a> 


Documentation de RStudio sur la connexion aux bases de données à l'aide de R <a href="https://db.rstudio.com" target="_blank">https://db.rstudio.com </a>


